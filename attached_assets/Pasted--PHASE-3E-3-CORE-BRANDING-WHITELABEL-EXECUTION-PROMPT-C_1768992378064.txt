
PHASE 3E-3 â€” CORE BRANDING / WHITELABEL (EXECUTION PROMPT)

CONTEXT (READ CAREFULLY)

You are implementing Phase 3E-3: webwaka-core-branding.

This is a HEADLESS, PURE TypeScript LIBRARY.

ğŸš« NO UI
ğŸš« NO CSS / Tailwind / rendering
ğŸš« NO persistence / database
ğŸš« NO feature flags logic
ğŸš« NO permissions / entitlements logic
ğŸš« NO network calls
ğŸš« NO Date.now(), randomness, or mutation

This implementation MUST strictly follow the Phase 3E-2 Formal Specification and the WebWaka Ecosystem Constitution v1.5+.

â¸»

SOURCE OF TRUTH (IMMUTABLE)
	â€¢	GitHub Repo: changerplanet/webwaka-core-branding
	â€¢	Branch: main
	â€¢	Registry already exists
	â€¢	Vercel exists (library-only; no runtime)
	â€¢	Currency: irrelevant here (tokens only)
	â€¢	Determinism + tenant isolation are non-negotiable

â¸»

REQUIRED SETUP (DO THIS FIRST)
	1.	Clone the repository
	â€¢	Clone changerplanet/webwaka-core-branding
	â€¢	If empty, DO NOT add placeholders
	â€¢	If Replit auto-adds files, DELETE them immediately
	2.	Project Type
	â€¢	TypeScript-only library
	â€¢	No framework presets
	â€¢	Node 20 compatible

â¸»

IMPLEMENTATION REQUIREMENTS

1ï¸âƒ£ DOMAIN MODELS (Zod-validated)

Implement immutable models:
	â€¢	BrandingTokenValue
	â€¢	BrandingLayer
	â€¢	BrandingContext
	â€¢	ResolvedToken
	â€¢	ResolvedBranding
	â€¢	BrandingSnapshot

Rules:
	â€¢	Readonly everywhere
	â€¢	Deep freeze exports
	â€¢	JSON-serializable

â¸»

2ï¸âƒ£ TOKEN CATEGORIES (DATA ONLY)

Support these categories (no behavior):
	â€¢	Primitive tokens
	â€¢	Semantic tokens
	â€¢	Brand tokens
	â€¢	Behavioral tokens

Tokens are plain values (string | number | boolean).

â¸»

3ï¸âƒ£ HIERARCHY (LOCKED)

Enforce exact precedence:

system < partner < tenant < suite < component < contextual

Higher overrides lower.
No ambiguity.
No merging randomness.

â¸»

4ï¸âƒ£ TIME-BOUND LAYERS
	â€¢	validFrom?
	â€¢	validTo?

Rules:
	â€¢	Use context.evaluationTime
	â€¢	Ignore invalid layers
	â€¢	Never use system time

â¸»

5ï¸âƒ£ CORE ENGINE (PURE)

Implement:

resolveBranding(context, layers): ResolvedBranding

Guarantees:
	â€¢	Deterministic
	â€¢	Stable key ordering
	â€¢	No input mutation
	â€¢	Explainability (source layer per token)

â¸»

6ï¸âƒ£ SNAPSHOT SYSTEM (MANDATORY)

Implement:
	â€¢	generateBrandingSnapshot(context, layers)
	â€¢	verifyBrandingSnapshot(snapshot)
	â€¢	resolveFromSnapshot(snapshot, evaluationTime?)

Snapshot requirements:
	â€¢	SHA-256 checksum
	â€¢	Tenant-bound
	â€¢	Tamper detection
	â€¢	Offline-safe
	â€¢	Deterministic snapshot IDs

â¸»

7ï¸âƒ£ TENANT ISOLATION (CRITICAL)
	â€¢	Every layer must match context.tenantId
	â€¢	Snapshot verification MUST validate tenantId
	â€¢	Violations throw CrossTenantAccessError

â¸»

8ï¸âƒ£ TESTS (MANDATORY)

Minimum tests to include:
	â€¢	âœ… Determinism (10Ã— identical output)
	â€¢	âœ… Hierarchy precedence correctness
	â€¢	âœ… Time-bound layer exclusion
	â€¢	âœ… Snapshot generation & verification
	â€¢	âœ… Snapshot tampering detection
	â€¢	âœ… Tenant isolation (live + snapshot)
	â€¢	âœ… JSON serialization round-trip

Coverage target: â‰¥80%

â¸»

9ï¸âƒ£ CAPABILITIES REGISTRATION

Update module.manifest.json with:

[
  "branding:resolve",
  "branding:snapshot.generate",
  "branding:snapshot.verify"
]


â¸»

10ï¸âƒ£ SCOPE ENFORCEMENT (VERIFY BEFORE COMMIT)

Before pushing:
	â€¢	âœ… npm test passes
	â€¢	âœ… npm run build passes
	â€¢	âœ… No UI / CSS files exist
	â€¢	âœ… No Date.now / randomness
	â€¢	âœ… No permissions / flags / entitlements logic
	â€¢	âœ… No persistence code

â¸»

HARD STOP

After implementation:

â›” STOP
â›” Do NOT proceed to Phase 3F
â›” Await formal review and authorization

â¸»

ACKNOWLEDGEMENT FORMAT

Reply only with:

â€œPhase 3E-3 acknowledged. Implementing exactly as specified.â€

Then execute.